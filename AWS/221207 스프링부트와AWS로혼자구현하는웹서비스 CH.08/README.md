- [Springboot and AWS\_03](#springboot-and-aws_03)
  - [CH.08 EC2서버에 프로젝트를 배포해 보자](#ch08-ec2서버에-프로젝트를-배포해-보자)
      - [1. EC2에 프로젝트 Clone받기](#1-ec2에-프로젝트-clone받기)
      - [2. 배포 스크립트 만들기](#2-배포-스크립트-만들기)
      - [3. 외부 Security 파일 등록하기](#3-외부-security-파일-등록하기)
      - [4. 스프링 부트 프로젝트로 RDS 접근하기](#4-스프링-부트-프로젝트로-rds-접근하기)
      - [5. EC2에서 소셜 로그인하기](#5-ec2에서-소셜-로그인하기)


# Springboot and AWS_03

## CH.08 EC2서버에 프로젝트를 배포해 보자

- 지금 내가 가진건
  
  - 스프링부트를 통한 서비스(서비스)
  
  - AWS를 통한 배포환경 구성(서버)
  
  이다. 이 둘을 조합해 **서비스를 배포**해보자.

#### 1. EC2에 프로젝트 Clone받기

- 이전에 `github`에 push한 프로젝트를 EC2에 접속하여 clone을 받자

- `./gradlew test`로 코드들의 수행을 테스트한다.
  
  - 자꾸만 실패한다 ^^; 2가지 경우가 있다.
    
    1. 설정으로 인해 로컬에서도 테스트가 통과되지 않는 경우
    
    2. EC2, RDS 생성 과정에서 보안그룹의 문제로 요청이 거부되는 경우
  
  - 난 2.의 경우라 EC2를 다시 생성하면서 잘못됨을 알았다.

#### 2. 배포 스크립트 만들기

- **배포** : 작성한 코드를 실제 서버에 반영하는 것, 아래 3개의 과정을 포괄하는 의미.
  
  - git을 통해 새 버전의 프로젝트 받음
  
  - Gradle, Maven을 통해 프로젝트 테스트와 빌드
  
  - EC2 서버에서 해당 프로젝트 실행 및 재실행

- 위 배포 과정을 수동으로 수행하기엔 불필요하게 반복적인 작업이 많다!
  
  - **쉘 스크립트**로 작성해 스크립트를 실행하면 배포 과정을 차례로 진행하도록 한다.
  
  - `deploy.sh`라는 이름의 쉘 스크립트를 생성한다.

#### 3. 외부 Security 파일 등록하기

- `.gitignore`에 `application-oauth.properties`는 제외대상으로 포함되어 있다.

- 공개된 git에 올리기엔 보안의 문제가 크다.
  
  - 공개 저장소가 아닌 **서버에 직접 설정을 추가**한다!
  
  - EC2서버에 접속하여 vim을 활용해 `application-oauth.properties`를 생성 후, 필요 내용을 추가한다.
  
  - 쉘 스크립트인 `deploy.sh`에 새로 생성한 `properties`파일을 사용하도록 수정한다.

#### 4. 스프링 부트 프로젝트로 RDS 접근하기

- RDS는 MairaDB를 사용중이다. 사용을 위해 아래 작업이 필요하다.
  
  - 테이블 생성
  
  - 프로젝트 설정 : 프로젝트가 MariaDB에 접근하기 위한 데이터베이스 드라이버 추가
    
    - MariaDB 드라이버를 `build.gradle`에 등록한다.
    
    - 서버에서 구동될 환경을 `application-real.properites`로 생성한다.
      
      - 실제 운영될 환경으로, 보안/로그상 이슈가 될 만한 설정을 모두 제거한다.
  
  - EC2 설정 : **데이터베이스 접속 정보**는 보안에 **매우매우매우** 중요하다. 공개 저장소가 아닌 서버 내부에 따로 관리하도록 한다.
    
    - OAuth와 같이 RDS 접속 정보도 보호 대상으로, 서버에 직접 설정 파일을 생성한다.
    
    - `application-real-db.properties` 파일 생성

#### 5. EC2에서 소셜 로그인하기

- AWS 보안 그룹에서 배포 서비스의 포트가 열려있는지 확인한다.

- 사용하는 소셜 로그인 클라우드 플랫폼에 AWS EC2 서버의 퍼블릭 DNS를 등록한다.

---

- 레퍼런스

> 스프링 부트와 AWS로 혼자 구현하는 웹 서비스
