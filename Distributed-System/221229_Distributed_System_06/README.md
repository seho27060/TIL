[TOC]

# Distributed_System_06

## 분산형 문서 검색 서비스 구축하기

- DB에 저장된 문서에서 검색 쿼리와 관련된 문서를 어떻게 찾을 수 있을까?
  
  - 검색 쿼리와 일치하는 갯수 찾기 -> 내용은 상관없는데 길이가 길어서 많이 포함될 수 있음
  
  - 검색 쿼리의 등장 빈도 검색 -> "the fast car"에서 인간은 "car"가 중심이지만, 컴퓨터에게는 "the", "fast", "car"가 모두 같음. 일반적으로 "the"가 많이 나와서 검색의 의미가 사라짐.

### TF-IDF Algorithm

- Term Frequency - Inverse Document Frequency(TF-IDF, 단어 빈도 - 역문서 빈도)

- 검색 쿼리의 모든 단어를 보고 각 단어가 얼마나 중요한지(의미있는지) 측정한다.

- 검색 쿼리 중 특정 단어가 모든 문서에 나타나면 중요도가 내려가고, 드물게 나오면 올라간다.

- 점수 산정 알고리즘
  
  > score(doc_i) = tf("term1", doc_i) \* idf("term1") + tf("term2", doc_i) * idf("term2") + tf("term3", doc_i) * idf("term3")
  
  - 단어 빈도(Term Frequency)
  
  - 역문서 빈도
    
    > df(term) = log(N/ nt), N - 문서의 개수, nt - term을 포함하는 문서의 개수

- 특징
  
  - 통계 알고리즘으로 데이터가 충분해야함.

- **병렬적으로 작동**하기에 용이하므로 해당 알고리즘으로 **분산 시스템을 구축**해보자.

### 병렬 TF-IDF 알고리즘과 시스템 아키텍쳐

#### 병렬 TF-IDF 알고리즘

- 분산 시스템에 TF-IDF 알고리즘을 적용하기 위해 병렬화를 적용
  
  - 문서의 개수, 검색 쿼리에서 단어의 개수 로 2개의 차원으로 분리할 수 있다.
  
  - 이때 어떤 차원을 병렬적으로 처리할 것인가 가 분산시스템 구축의 고려사항
    
    - 문서의 개수를 나눌 경우 -> 각 노드에 정해진 갯수의 문서를 할당 후 검색 시작
    
    - 검색 쿼리의 단어로 나눌 경우 -> 각 노드에 단어를 할당하여 전체 문서에서 단어를 검색
  
  - 분산 시스템의 효율성, 확장성을 고려하자.
    
    - 2개의 차원중 어떤 데이터가 시간이 지나면 증가할까? -> 문서의 양이 증가한다.
    
    - 문서의 개수에 따라 병렬적으로 알고리즘을 구현한다.

#### 시스템 아키텍쳐

- Zookeeper
  
  - 워커 노드 서비스 레지스트리 - Worker 노드 등록 후, 작업 가능 리스트 업

- 프론트엔드 - 검색 쿼리 입력 받고 리더 노드에 전달

- 분산 시스템
  
  - 리더 노드
    
    - 쿼리를 입력받으면 워커 노드 레지스트리에서 작업 가능 노드 확인 후 [검색 쿼리, 할당 문서, 작업]을 배정한다.
    
    - 작업이 완료되면 워커노드에서 집계(Aggregation) 후 점수 할당(Scoring), 정렬(Sorting)하여 프론트엔드에 반환한다.
  
  - 워커 노드 - 배정 받은 내용을 TF-IDF 알고리즘에 따라 작업한다.

#### 실행화면

![](C:\Users\seho2\AppData\Roaming\marktext\images\2022-12-29-22-11-17-image.png)

- 주키퍼 서버

- 프론트엔드 서버

- 워커 노드 4개
  
  - 리더 노드 1개 선출
  
  - 워커 노드 3개

- 주키퍼 서버가 주관하여 분산 코디네이터 역할을 수행한다. 연결된 워커 노드를 관리(연결, 오류, 끊김 etc)하며 리더 선출에 관여한다.

- 프론트엔드에서 오는 요청은 직렬화/역직렬화를 거쳐 HTTP 통신으로 송/수신된다.

- 워커 노드에서는 리더 노드의 주관으로 Document, Term, Task가 할당되어 작업이 진행된다.

- 리더 노드는 결과물을 집계하여 프론트엔드 서버에 반환한다.

- 결과물 출력.

---

- 레퍼런스

> [Java 를 활용한 분산 시스템 및 클라우드 컴퓨팅](https://www.udemy.com/course/java-distributed-system/)
