[TOC]

# Distributed_System_02

## 분산 코디네이터와 분산 알고리즘

### 클러스터 코디네이션과 리더 선출 알고리즘-01

#### 노드와 클러스터

- 노드 : 분산 시스템의 일부로 동작하는 시스템에서 실행되는 프로세스

- 클러스터 : 서로 연결된 노드의 모음.

#### 필요성

- 분산 시스템의 가장 큰 이점은 각자의 작업이 할당된 노드들이 병렬적, 독립적으로 자신의 작업을 수행한다.

- 초당 수천개의 작업이 요청될 시 1개의 리더(마스터)노드를 선정하여 작업 분배와 결과 수집을 담당하게 한다.
  
  - 이때 리더 노드를 포함한 어떤 노드들이든 언제든 작업을 **실패**할 수 있다.
  
  - 만약 리더 노드가 작업을 실패한다면? -> 연결된 모든 노드들 역시 작업을 수행할 수 없는 대재앙으로 이어진다.

- 해결책은 노드들이 필요에 따라 리더 노드를 선출(Automatic Leader Election)하고 모든 노드가 리더의 상태를 예의주시한다.
  
  - 리더 노드가 동작할 수 없다면, 나머지 노드 중 새로운 리더 노드를 선출한다.
  
  - 기존에 중지한 리더 노드는 이미 새로운 리더 노드가 선출되었기 때문에, 일반 노드로 돌아가 작업을 진행한다.

- 동일한 노드로 구성된 노드 그룹에서
  
  - 새로운 리더 노드 선출의 어려움, 기본적으로 노드들은 서로 연결되지 않음, 고장 감지 장치가 필요 등의 조건이 존재한다.

- 위와 같은 상황을 해결하기 위한 해결책으로 오픈소스 분산 코디네이터 도구인 **Zookeeper**가 있다.

#### 특징

- 호환성 높은 알고리즘으로 높은 가용성과 신뢰성을 보장하는 분산 시스템

- 최소 3개 이상의 홀수개의 노드를 사용하므로 주키퍼 노드 하나를 잃어도 정상 작동한다.

- 노드들 서로가 통신하는게 아닌 Zookeeper 클러스터 하나와 통신하여 작업을 진행한다.

- 높은 추상화를 통한 사용하기 좋은 접근성과 데이터 모델

- 데이터 모델은 Znode라는 단위 노드로 구성된 트리형태로 구성되어 있다.
  
  - Znode
    
    - 파일과 디렉토리의 그 중간
    
    - 파일 자체를 가질수도 있으며, 자식 노드를 가질 수 도 있다.
    
    - 세션이 종료되도 살아있는 영구 Znode와 삭제되는 임시 Znode가 있다.

#### 리더 선출 알고리즘(Leader Election Algorithm)

- 알고리즘의 간단한 아이디어는 아래와 같다.
  
  1. 주키퍼와 연결된 모든 노드들은 리더 후보에 자원한다.
  
  2. 모든 노드들은 Election 노드에 자신의 Znode를 등록한다. 이때 등록 순서에 따라 Sequential한 번호가 매겨진다.
  
  3. Election 노드는 Znode들 중 가장 작은 Sequential 번호를 갖는 노드를 리더로 선출한다.

#### Zookeeper 설치 및 실행

- `zookeeper`를 원하는 버전 다운로드

- `zookeeper`에 따른 적절한 `jdk` 실행

- 환경 변수로 `JAVA_HOME`에 `jdk`를 설정해준다. 

---

- 레퍼런스

> [Java 를 활용한 분산 시스템 및 클라우드 컴퓨팅](https://www.udemy.com/course/java-distributed-system/)
