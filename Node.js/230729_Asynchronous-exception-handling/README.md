[TOC]

# Node.js

## Asynchronous exception handling

- ë¹„ë™ê¸° ì˜ˆì™¸ ì²˜ë¦¬

- ë¹„ë™ê¸°ê°€ ê°„ë‹¨í•˜ê²Œ "ìš”ì²­ì— ëŒ€í•œ ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ì§€ ì•ŠëŠ”" ë°©ì‹ì´ë¼ í• ë•Œ,
  ê°ì²´ ì§€í–¥ìœ¼ë¡œ ë©”ì„œë“œë¥¼ ìž‘ì„±í• ë•Œ ë“œë¬¸ ì˜ë¬¸ì— ëŒ€í•œ í•´ë‹µ ì°¾ê¸°
  
  - ë©”ì„œë“œë¥¼ ìž‘ì„±í•˜ë©´ì„œ ë™ê¸°/ë¹„ë™ê¸°ë¡œ íë¥´ëŠ” ìž‘ë™ íë¦„ì€ ì•Œê² ìœ¼ë‚˜.. ì˜ˆì™¸ ì²˜ë¦¬ì—ì„œ ì˜ë„í•œ ë°©í–¥ëŒ€ë¡œ ìž‘ë™í•˜ì§€ ì•ŠëŠ” ë¬¸ì œ ë°œìƒ ðŸ˜‚

- ë¹„ë™ê¸° ë¶€í„°..`Promise`, `try-catch,finally` ê¹Œì§€ ì •ë¦¬

### ë¹„ë™ê¸° í•¨ìˆ˜

- ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ ë‹¤ë£¨ê¸° ìœ„í•œ ë°©ë²•ìœ¼ë¡œ `Promise`ì™€ `async-await`ê°€ ìžˆë‹¤.

- ì•„ëž˜ëŠ” ì´ì— ëŒ€í•œ ê°„ë‹¨í•œ ì„¤ëª…

#### Promise

> `Promise`ëŠ” í”„ë¡œë¯¸ìŠ¤ê°€ ìƒì„±ëœ ì‹œì ì—ëŠ” ì•Œë ¤ì§€ì§€ ì•Šì•˜ì„ ìˆ˜ë„ ìžˆëŠ” ê°’ì„ ìœ„í•œ ëŒ€ë¦¬ìžë¡œ, ë¹„ë™ê¸° ì—°ì‚°ì´ ì¢…ë£Œëœ ì´í›„ì— ê²°ê³¼ ê°’ê³¼ ì‹¤íŒ¨ ì‚¬ìœ ë¥¼ ì²˜ë¦¬í•˜ê¸° ìœ„í•œ ì²˜ë¦¬ê¸°ë¥¼ ì—°ê²°í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤. í”„ë¡œë¯¸ìŠ¤ë¥¼ ì‚¬ìš©í•˜ë©´ ë¹„ë™ê¸° ë©”ì„œë“œì—ì„œ ë§ˆì¹˜ ë™ê¸° ë©”ì„œë“œì²˜ëŸ¼ ê°’ì„ ë°˜í™˜í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤. ë‹¤ë§Œ ìµœì¢… ê²°ê³¼ë¥¼ ë°˜í™˜í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆê³ , ë¯¸ëž˜ì˜ ì–´ë–¤ ì‹œì ì— ê²°ê³¼ë¥¼ ì œê³µí•˜ê² ë‹¤ëŠ” 'ì•½ì†'(í”„ë¡œë¯¸ìŠ¤)ì„ ë°˜í™˜í•©ë‹ˆë‹¤. - [Mozilla]([Promise - JavaScript | MDN](https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/Promise#%EC%84%A4%EB%AA%85))

```javascript
const func = (params) => {
    // ë³€ìˆ˜ê°’ ë‹¨ìˆœ í• ë‹¹ê³¼ ê°™ì€ ê°„ë‹¨í•œ ìž‘ì—…
...

return new Promise((resolove, reject) => {
    // ë¹„ë™ê¸° ì²˜ë¦¬ê°€ í•„ìš”í•œ ìž‘ì—…
    ...
    if( result == ì„±ê³µ) {
    resolve(ì„±ê³µì˜ ë°˜í™˜ê°’)
} else if (result == ì‹¤íŒ¨){
    reject(ì‹¤íŒ¨ì˜ ë°˜í™˜ê°’)
}
})
```

- `Promise` ê°ì²´ë¥¼ ë°˜í™˜ í•¨ìœ¼ë¡œ, `Promise`ì— í• ë‹¹ëœ ìž‘ì—…ì„ ìˆ˜í–‰í•œë‹¤.

- ì„±ê³µí–ˆì„ ì‹œëŠ” `resolve`ì˜ ê°’ì„, ì‹¤íŒ¨í–ˆì„ë•ŒëŠ” `reject`ì˜ ê°’ ë°˜í™˜

- `Promise` ë‚´ë¶€ì—ì„œ ë°œìƒí•˜ëŠ” ì˜ˆì™¸ì— ëŒ€í•´ì„œë„ `reject`ë¥¼ ë°˜í™˜í•œë‹¤.
  
  - `Promise` executorì™€ `.then`, `.catch`ì™€ ê°™ì€ `Promise` í•¸ë“¤ëŸ¬ì—ì„œ ë°œìƒí•˜ëŠ” ì˜ˆì™¸ëŠ” ê°€ìž¥ **ê°€ê¹Œìš´ ì—ëŸ¬ í•¸ë“¤ëŸ¬**ë¡œ ì²˜ë¦¬í•˜ê²Œ ëœë‹¤.
  - ì´ ì£¼ìœ„ì—ëŠ” 'ë³´ì´ì§€ ì•ŠëŠ”(ì•”ì‹œì ) `try-catch`' ê°€ ì¡´ìž¬í•˜ëŠ” ê²ƒê³¼ ê°™ë‹¤.

- `Promise`ì˜ ìž‘ë™ íë¦„ì€ ì•„ëž˜ì™€ ê°™ë‹¤.
  ![](https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/Promise/promises.png)
  
  - `Promise` ìƒì„±ì‹œ "pending" ìƒíƒœê°€ ë˜ë©°, ì„±ê³µ ì—¬ë¶€ì— ë”°ë¼ "fulfill"ë˜ê±°ë‚˜ "reject" í•œë‹¤.
  
  - ë³€ìˆ˜ì— `Promise` ê°ì²´ë¥¼ í˜¸ì¶œ ì´í›„ì— `resolve` ë˜ëŠ” `reject`ë¡œ ê²°ê³¼ ë°˜í™˜ ì „ì— ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•  ê²½ìš°, pending ìƒíƒœì˜ `Promise` ê°ì²´ê°€ í˜¸ì¶œëœë‹¤.
    
    - ì´ëŠ” ì‚¬ìš©ìžê°€ ë¹„ë™ê¸° íë¦„ì„ ì´í•´í•˜ì§€ ëª»í•˜ì—¬, **ì˜ë„í•˜ì§€ ì•ŠëŠ”(ì˜ˆìƒí•˜ì§€ ëª»í•œ)** ìž‘ë™ íë¦„ìœ¼ë¡œ ì´ì–´ì§€ë¯€ë¡œ ì£¼ì˜í•´ì•¼ í•œë‹¤.(ì´ ê¸€ ì“°ëŠ” ì´ìœ )

#### async-await

- ì´ë¦„ê³¼ ê°™ì´ ë¹„ë™ê¸°(async)ì™€ ë™ê¸°(await)ë¥¼ êµ¬ë¶„í•˜ì—¬ ìž‘ë™í•˜ê²Œ í•œë‹¤.

```javascript
const func2 = async (req, res) => {
    // ê°„ë‹¨ ìž‘ì—…...
    ...
    // ë¹„ë™ê¸° í•¨ìˆ˜ì¸ asyncFuncì˜ ê²°ê³¼ë¥¼ ê¸°ë‹¤ë¦°ë‹¤(ë™ê¸°ì  ìž‘ë™).
    await asyncFunc()
    .then(data => doSometing(data))
    .catch(error => console.error(error))

   const value = asyncFunc2(); // ë¹„ë™ê¸° í•¨ìˆ˜ì´ì§€ë§Œ awaitê°€ ì—†ìœ¼ë¯€ë¡œ ë‹¤ìŒ ë™ìž‘ì„ ìˆ˜í–‰í•œë‹¤

   const result = makeResult();
   return res(json);
}
```

- ìœ„ì™€ ê°™ì´ í•¨ìˆ˜ ì„ ì–¸ì—ì„œ asyncë¥¼ ë‹¬ì•„ì¤Œìœ¼ë¡œ ë¹„ë™ê¸° í•¨ìˆ˜ìž„ì„ ëª…ì‹œí•œë‹¤.
- í•´ë‹¹ êµ¬ë¬¸ ë‚´ì—ì„œ `await`ê°€ ë¶™ì€ ë¹„ë™ê¸° í•¨ìˆ˜ëŠ” ë™ê¸°ì ìœ¼ë¡œ ìž‘ë™í•œë‹¤.
  - í•´ë‹¹ ë¹„ë™ê¸° í•¨ìˆ˜ ë‚´ë¶€ì—ì„œë„ ë¹„ë™ê¸°ë¡œ ìž‘ë™í•  ìˆ˜ ë„ ìžˆì§€ë§Œ, ìš°ì„  í•´ë‹¹ êµ¬ë¬¸ì—ì„œëŠ” ë¹„ë™ê¸° í•¨ìˆ˜ì˜ **ê²°ê³¼ë¥¼ ê¸°ë‹¤ë¦°ë‹¤**.
- `async-await`ë¡œ ìž‘ì„±ëœ í•¨ìˆ˜ëŠ” `Promise` ê°ì²´ë¥¼ ë°˜í™˜í•˜ë¯€ë¡œ, `.then-.catch`ì™€ ê°™ì€ `Promise` í•¸ë“¤ëŸ¬ ì‚¬ìš©ì´ ê°€ëŠ¥í•˜ë‹¤.

### ë¹„ë™ê¸° í•¨ìˆ˜ì—ì„œì˜ ì˜ˆì™¸ ì²˜ë¦¬

- ë¹„ë™ê¸°ì‹ìœ¼ë¡œ ìž‘ë™í•˜ëŠ” ì½œë°±(callback)ì˜ **ë‚´ë¶€ì—ì„œ ë°œìƒí•˜ëŠ” ì—ëŸ¬**ëŠ”, ì½œë°± ë°”ê¹¥ì— ìžˆëŠ” `try-catch` ë¸”ë¡ìœ¼ë¡œ ìž¡ì•„ë‚¼ ìˆ˜ ì—†ë‹¤.
  
  - `JavaScript` ì—”ì§„ì€ ì—ëŸ¬ê°€ ë°œìƒí•˜ëŠ” ìˆœê°„, í˜¸ì¶œ ìŠ¤íƒì„ ë˜ê°ëŠ” ê³¼ì •ì„ ê±°ì¹œë‹¤.
  
  - ìœ„ ê³¼ì •ì—ì„œ `try-catch` ë¸”ë¡ì„ ë§Œë‚˜ì•¼ ì½”ë“œì˜ ì‹¤í–‰ íë¦„ì„ ì›ìƒ ë³µêµ¬ì‹œí‚¬ ìˆ˜ ìžˆë‹¤.
  
  - í•˜ì§€ë§Œ ë‹¨ìˆœ `try-catch` ë‚´ë¶€ì—ì„œ ë¹„ë™ê¸°ë¥¼ ìˆ˜í–‰í•˜ëŠ” ì½”ë“œì˜ ê²½ìš°, ë¹„ë™ê¸°ì  ìž‘ë™ íë¦„ì— ì˜í•´ ì›ë³µì´ ë˜ì§€ ì•ŠëŠ”ë‹¤.

- ë¹„ë™ê¸°ì‹ìœ¼ë¡œ ìž‘ë™í•˜ëŠ” ì½œë°± ë‚´ë¶€ì˜ ì—ëŸ¬(ì˜ˆì™¸) ì²˜ë¦¬ë¥¼ ìœ„í•´ì„œëŠ”, ì½œë°± ë‚´ë¶€ì—ì„œ `try-catch`ë¥¼ ìˆ˜í–‰í•˜ê±°ë‚˜ `Promise` ê°ì²´ë¥¼ ì‚¬ìš©í•œë‹¤.

#### try-catch-finally

- ì´ì œê¹Œì§€ ë°°ìš°ê³ , ì‚¬ìš©í•´ì™”ë˜ ë™ê¸°ì  í”„ë¡œê·¸ëž˜ë°ì—ì„œëŠ”.. ìˆœì„œë¥¼ ìƒê°í•  í•„ìš”ê°€ ì—†ì—ˆë‹¤. ì ì–´ë„ `try-catch-finally`ì—ì„œëŠ”.

- í•˜ì§€ë§Œ `node.js`ì—ì„œëŠ” ê·¸ íë¦„ì´ ì°¨ì´ê°€ ë‚œë‹¤.

- ê¸°ì¡´ì˜ `try-catch-finally`ëŠ” 
  
  1. `try` ë¸”ë¡ ì‹¤í–‰
  
  2. ì˜ˆì™¸ ë°œìƒì‹œ `catch` ë¸”ë¡ì—ì„œ ìž¡ì•„ë‚´ì–´ ì²˜ë¦¬
  
  3. ë­ê°€ ë˜ë“ ê°„ì— `finally` ë¸”ë¡ ìˆ˜í–‰

#### finallyì™€ Promise í•¸ë“¤ë§

- `try-catch-finally`ì˜ ìˆ˜í–‰ íë¦„ì€ ë¹„ë™ê¸°ì—ì„œë„ ë˜‘ê°™ì´ ì ìš©ë˜ë‚˜.. 
  **"ë¹„ë™ê¸°" ì ìœ¼ë¡œ ìˆ˜í–‰**í•¨ì„ ê³ ë ¤í•´ì•¼ í•œë‹¤.
  
  ```javascript
  const func3 = async (input) => {
      const beforeAct = doSomething();
  
      doSomething2();
  
      let result;
      promiseMethod()
      .then(data => result = data)
      .catch(err => result = err)
      .finally(
          promiseMethod2(result);
          return result;
      );
   })
  }
  ```
  
  ì´ì™€ ê°™ì€ í•¨ìˆ˜ `func3`ì´ ìƒì„±ë˜ì—ˆë‹¤.

- ```javascript
  const resultValue = func3(inputData);
  doSomething4(resultValue);
  ```
  
  ìœ„ì™€ ê°™ì€ ì½”ë“œì—ì„œ ì‹¤í–‰ ê²°ê³¼ì¸ `resultValue`ëŠ” pending ìƒíƒœì˜ `Promise` ê°ì²´ê°€ ë°˜í™˜ëœë‹¤.
  
  - `async` ê°€ ì„ ì–¸ëœ ë©”ì„œë“œëŠ” `Promise` ê°ì²´ê°€ ë°˜í™˜ë¨ì„ ìžŠì§€ë§ìž.

- ```javascript
  func3(inputData)
  .then(res => doSomething4(res))
  .catch(err => console.error(err);
  ```
  
  ë§Œì•½ `.then`, `.catch`ë¥¼ í†µí•´ í•¸ë“¤ë§ì„ í–ˆì„ë•Œ, `func3`ì˜ **`finally` ë¸”ë¡ì—ì„œ `promiseMethod2` ë©”ì„œë“œ ìˆ˜í–‰ ì¤‘ ì—ëŸ¬ê°€ ë°œìƒí–ˆì„ ê²½ìš°**
  `func3.catch()`ë¥¼ í†µí•´ ì—ëŸ¬ë¥¼ ìž¡ì•„ë‚´ì§€ ëª»í•œë‹¤.
  
  - ì´ëŠ”  `finally`ì˜ ì½œë°±ì˜ íë¦„ì— ì˜í•œ ê²ƒì¸ë°, `try-catch` ë¸”ë¡ë‚´ì—ì„œ ë°œìƒí•˜ëŠ” ì—ëŸ¬ë¥¼ `catch`ê°€ ìž¡ì•„ì£¼ì§€ ëª»í•˜ëŠ” ê²ƒì²˜ëŸ¼, ì½œë°±ì˜ ì—ëŸ¬ëŠ” ì½œë°± ë‚´ë¶€ì—ì„œ ì²˜ë¦¬í•´ì•¼ í•œë‹¤.

- ì½œë°± ë‚´ë¶€ì—ì„œ ì ì ˆížˆ `try-catch`ë¥¼ ì‚¬ìš©í–ˆìŒì—ë„ ë¬¸ì œê°€ ë°œìƒí•œë‹¤ë©´, í•´ë‹¹ ì½œë°±ì˜ ì—ëŸ¬ ë°œìƒì„ JavaScript(node.js)ì—ì„œ **stackì„ ì¶”ì í•  ìˆ˜ ì—†ê²Œ** ë˜ëŠ” ê²ƒì´ë‹¤.
  - `Promise` ëŠ” ì•”ì‹œì ì¸ `try-catch`ë¡œ wrappingë˜ì–´ ìžˆë‹¤ëŠ” ê±¸ ë– ì˜¬ë¦¬ë©´ í•´ê²° ë°©ë²•ì€ ê°„ë‹¨í•˜ë‹¤.
  
  ```javascript
  const func3 = async (input) => {
      const beforeAct = doSomething();
  
      doSomething2();
  
      return new Promise((resolove) => {
      promiseMethod()
      .then(data => result = data)
      .catch(err => result = err)
      .finally(
          promiseMethod2(result);
          resolove(result);
      );
      })
  }
  ```
  
  - ì˜ˆì™¸ê°€ ë°œìƒ ê°€ëŠ¥í•œ ë¶€ë¶„ì„ `Promise`ë¡œ ê°ì‹¸ê²Œ ë˜ë©´, ì•”ì‹œì  `try-catch`ë¡œ ì˜ˆì™¸ì²˜ë¦¬ê°€ ê°€ëŠ¥í•˜ë‹¤.
  
  - **í•˜ì§€ë§Œ!!,** `undefinedException`ê³¼ ê°™ì´ **ê°œë°œìžê°€ ì˜ë„í•˜ì§€ ì•ŠëŠ” ì˜ˆì™¸, ì—ëŸ¬**ê°€ ë°œìƒí•  ìˆ˜ ìžˆìœ¼ë¯€ë¡œ ë§¹ëª©ì ì¸ ì‚¬ìš©ì€ ìžì œí•˜ìž.
  
  - ë¹„ë™ê¸°ì ì¸ íë¦„ì—ì„œ ì˜ë„í•˜ëŠ” ì‚¬í•­ì´ ì–´ë–¤ ê²ƒì¸ì§€ ëª…í™•í•˜ê²Œ í•˜ê³ , ì‹¤ì œ ê³¼ì •ì„ ì •í™•ížˆ ì´í•´í•˜ëŠ” ì‚¬ì „ ìž‘ì—…(ì„¤ê³„)ê°€ í•„ìš”í•˜ë‹¤.

---

- ë ˆí¼ëŸ°ìŠ¤

> [[JavaScript]async, await ì˜ˆì™¸ ì²˜ë¦¬](https://developer-talk.tistory.com/370)
> 
> https://ko.javascript.info/promise-error-handling
> 
> [Promise - JavaScript | MDN](https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/Promise#%EC%84%A4%EB%AA%85)
> 
> https://helloworldjavascript.net/pages/290-exception.html#%EB%B9%84%EB%8F%99%EA%B8%B0%EC%8B%9D-%EC%BD%94%EB%93%9C%EC%97%90%EC%84%9C%EC%9D%98-%EC%98%88%EC%99%B8-%EC%B2%98%EB%A6%AC
